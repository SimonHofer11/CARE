# CARE

This repository contains the implementation source code of the following paper:

[CARE: Coherent Actionable Recourse based on Sound Counterfactual Explanations](https://arxiv.org/abs/2108.08197)

Bibtex:

    @misc{rasouli2021care,
          title={CARE: Coherent Actionable Recourse based on Sound Counterfactual Explanations}, 
          author={Peyman Rasouli and Ingrid Chieh Yu},
          year={2021},
          eprint={2108.08197},
          archivePrefix={arXiv},
          primaryClass={cs.LG}
    }

# Setup
1- Clone the repository using HTTP/SSH:
```
git clone https://github.com/peymanrasouli/CARE
```
2- Install the following package containing GCC/g++ compilers and libraries:
```
sudo apt-get install build-essential
```
3- Create a conda virtual environment:
```
conda create -n CARE python=3.7
```
4- Activate the conda environment: 
```
conda activate CARE
```
5- Standing in CARE directory, install the requirements:
```
pip install -r requirements.txt
```

# Explaining instances
1- To explain a particular instance using CARE run:
```
python main.py
```
2- To simultaneously explain a particular instance using CARE, CFPrototype, DiCE, and CERTIFAI run:
```
python care_cfprototype_dice_certifai.py
```

# Explanation Example
An explanation generated by CARE for an instance from Adult data set:

| Features | Original | Counterfactual |
|:---:|:---:|:---:|
| age | 35 | 42 |
| capital-gain | 0 | \_ |
| capital-loss | 0 | \_ |
| hours-per-week | 40 | 45 |
| work-class | Private | \_ |
| education | HS-grad | Masters |
| marital-status | Divorced | \_ |
| occupation | Sales | Prof-specialty |
| relationship | Unmarried | \_ |
| race | White | \_ |
| sex | Female | \_ |
| native-country | United-States | \_ |
| Class | <=50K | \>50K |


**IF** 'age was 42' **AND** 'hours-per-week was 45' **AND** 'education was Masters' **AND** 'occupation was Prof-specialty', 

**THE PERSON WOULD BE CLASSIFIED AS** 'RECEIVING >50K SALARY' **RATHER THAN**  'RECEIVING <=50K SALARY'.

# Reproducing the validation results
1- To reproduce the results of module effect validation run:
```
python care_module_effect.py
```
2- To reproduce the results of soundness validation run:
```
python care_soundness.py
```
3- To reproduce the results of action series validation run:
```
python care_action_series.py
```
4- To reproduce the results of coherency validation run:
```
python care_coherency.py
```

# Reproducing the benchmark results
1- To reproduce the results of CARE<sub>{VALIDITY}</sub> config vs. baselines run:
```
python benchmark_validity.py
```
2- To reproduce the results of CARE<sub>{VALIDITY, SOUNDNESS}</sub> config vs. baselines run:
```
python benchmark_validity_soundness.py
```
3- To reproduce the results of CARE<sub>{VALIDITY, SOUNDNESS, COHERENCY}</sub> config vs. baselines run:
```
python benchmark_validity_soundness_coherency.py
```
4- To reproduce the results of CARE<sub>{VALIDITY, SOUNDNESS, COHERENCY, ACTIONABILITY}</sub> config vs. baselines run:
```
python benchmark_validity_soundness_coherency_actionability.py
```
5- To reproduce the results of coherency benchmark of CARE vs. baselines run:
```
python benchmark_coherency.py
```